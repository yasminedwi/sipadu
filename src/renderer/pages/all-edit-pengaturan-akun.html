<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Akun</title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body class="dashboard-page">

    <header class="top-bar" id="topBar">

        <!-- ADMIN AREA -->
        <div id="adminArea">
        <button class="admin-btn"
            onclick="window.location.href='admin-page.html'">
            ADMIN
        </button>
        </div>

        <img src="../css/images/logo-dpmptsp-v-footer.png"
            class="logo-mini" alt="Logo DPMPTSP">
        <img src="../css/images/Lambang_Kota_Kendari.png"
            class="logo-kota" alt="Logo Kota Kendari">

        <nav>
            <button class="nav-btn" style="top: -13px;"
                onclick="window.location.href='all-read-dashboard.html'">
                BERANDA
            </button>

            <button class="nav-btn1 active" style="top: -2px;"
                onclick="window.location.href='all-edit-pengaturan-akun.html'">
                AKUN
            </button>

            <button class="nav-btn2" style="top: -14px;"
                onclick="window.location.href='all-konfirmasi-logout.html'">
                KELUAR
            </button>
        </nav>
    </header>

    <!-- CONTENT LAYERS -->
    <div class="content1"></div>
    <div class="content2"></div>
    <div class="content3"></div>
    
<main class="content">
    <div class="akun-wrapper">
        <div class="akun-left">
            <p>Foto Profil</p>
            <div class="foto-profil">
                <img id="previewFoto" width="120">
                <input type="file" id="profilePic" accept="image/*">
            </div>
        </div>

        <div class="akun-divider"></div>

        <div class="akun-right">
            <!-- FORM MULAI DI SINI -->
            <form id="editForm">

                <label>Nama Lengkap</label>
                <input type="text" id="nama">

                <label>NIP</label>
                <input type="text" id="nip">

                <label>Password Baru</label>
                <input type="password" id="password" placeholder="Kosongkan jika tidak diubah">

                <div class="akun-button">
                    <button class="btn-batal" type="reset">Batal</button>
                    <button class="btn-simpan" type="submit">Simpan</button>
                </div>

            </form>
            <!-- FORM SELESAI DI SINI -->

        </div>
    </div>
</main>
      <!-- ROLE CHECK -->
    <script>
        const { ipcRenderer } = require("electron");

        const form = document.getElementById("editForm");

        if (!loginUser) {
        window.location.href = "login.html";
        }

        const adminArea = document.getElementById("adminArea");
        const topBar = document.getElementById("topBar");

        if (loginUser.role !== "admin") {
        adminArea.style.display = "none";
        } else {
        topBar.classList.add("admin-top-bar");
        }
    </script>

    <script>
        const { ipcRenderer } = require("electron");

        const form = document.getElementById("editForm");

        // LOAD DATA USER
        async function loadUser() {
            const result = await ipcRenderer.invoke("get-user", loginUser.nip);

            if (result.success) {
                document.getElementById("nama").value = result.user.nama;
                document.getElementById("nip").value = result.user.nip;

                if (result.user.foto) {
                    document.getElementById("previewFoto").src = result.user.foto;
                }
            }
        }

        loadUser();

        // PREVIEW FOTO
        document.getElementById("profilePic").addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (file) {
                document.getElementById("previewFoto").src = file.path;
            }
        });

        // SAVE PERUBAHAN
        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const fileInput = document.getElementById("profilePic");

            const result = await ipcRenderer.invoke("update-user", {
                nip: loginUser.nip,
                nama: document.getElementById("nama").value,
                password: document.getElementById("password").value,
                filePath: fileInput.files[0] ? fileInput.files[0].path : null
            });

            if (result.success) {
                alert("Akun berhasil diupdate!");
            } else {
                alert("Gagal update akun");
            }
        });
        </script>

</body>
</html>